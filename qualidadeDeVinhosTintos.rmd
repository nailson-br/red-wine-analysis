---
output:
    html_document:
        toc: true
        toc_depth: 3
        toc_float: true
editor_options: 
  chunk_output_type: console
---
Qualidade de Vinhos Tintos por Nailson dos Santos
========================================================

```{r echo=FALSE, message=FALSE, warning=FALSE, packages}
# Carregue aqui todos os pacotes utilizados 
# na sua análise realizada neste arquivo fonte.

# Note que o parâmetro "echo" foi definido como FALSE neste código.
# Isso previne que o código apresente resultados formatados em HTML.
# Você deve definir echo=FALSE para todos os blocos de código no seu arquivo.

library(ggplot2)
library(dplyr)
library(GGally)
library(gridExtra)
library(corrplot)
```

```{r echo=FALSE, Load_the_Data}
# Acessando diretório local
setwd('.')

# Carregamento dos dados
vinhos <- read.csv('wineQualityReds.csv', sep = ',')
```

# Seção de Gráficos Univariados
### Análise individual dos fatores do conjunto de dados
Inicialmente serão plotados os histogramas para avaliar a distribuição dos fatores observados em cada uma das amostras de vinho tinto.
```{r echo=FALSE, Univariate_Plots}

# Plota um gráfico de histograma com cor definida como 'black' e
# preenchimento definido como '#099DD9'.
# Parâmetros: 
# @param dataset Objeto com o dataset armazenado
# @param x_axis Variável do dataset para ser usada no eixo x
# @param bin_widht Valor numérico para ser usado no binwidth
# @xl Nome do eixo x (default = '')
plot_hist <- function(data_set, x_axis, bin_width, xl = '') {
    # Histograma
    ggplot(data = data_set, aes(x = x_axis)) +
        geom_histogram(binwidth = bin_width, 
                       color = 'black', 
                       fill = '#099DD9') +
        xlab(xl) +
        ylab('')
}

# Matriz dos histogramas dos fatores
grid.arrange(
             # Acidez fixa
             plot_hist(data_set = vinhos,
                       x_axis = vinhos$fixed.acidity,
                       bin_width = 0.2, 
                       xl = 'acidez fixa'),
             
             # Acidez volátil
             plot_hist(data_set = vinhos,
                       x_axis = vinhos$volatile.acidity,
                       bin_width = 0.05,
                       xl = 'acidez volátil'),
             
             # Ácido Cítrico
             plot_hist(data_set = vinhos, 
                       x_axis = vinhos$citric.acid,
                       bin_width = 0.05,
                       xl = 'ácido cítrico'),
             
             # Açúcar residual
             plot_hist(data_set = vinhos, 
                       x_axis = vinhos$residual.sugar,
                       bin_width = 0.2,
                       xl = 'açúcar residual'),
             
             # Cloreto
             plot_hist(data_set = vinhos,
                       x_axis = vinhos$chlorides,
                       bin_width = 0.01,
                       xl = 'cloretos'),
             
             # Dióxido de Enxofre livres
             plot_hist(data_set = vinhos,
                       x_axis = vinhos$free.sulfur.dioxide,
                       bin_width = 1,
                       xl = 'dióxido de enxofre livres'),
             
             # Dióxido de Enxofre Total
             plot_hist(data_set = vinhos,
                       x_axis = vinhos$total.sulfur.dioxide,
                       bin_width = 5,
                       xl = 'dióxido de enxofre total'),
             
             # Densidade
             plot_hist(data_set = vinhos,
                       x_axis = vinhos$density,
                       bin_width = 0.0005,
                       xl = 'densidade'),
             
             # pH
             plot_hist(data_set = vinhos,
                       x_axis = vinhos$pH,
                       bin_width = 0.02,
                       xl = 'pH'),
             
             # Sulfatos
             plot_hist(data_set = vinhos,
                       x_axis = vinhos$sulphates,
                       bin_width = 0.05,
                       xl = 'sulfatos'),
             
             # Álcool
             plot_hist(data_set = vinhos,
                       x_axis = vinhos$alcohol,
                       bin_width = 0.2,
                       xl = 'álcool'),
             
             # Qualidade
             plot_hist(data_set = vinhos,
                       x_axis = vinhos$quality,
                       bin_width = 1,
                       xl = 'qualidade'),
             ncol = 3)
```

Avaliando os gráficos gerados pode-se perceber que as variáveis **density**
e **pH** têm distribuição normal.

Em contrapartida, **fixed.acidity**, **volatile.acidity**, **residual.sugar**, **chlorides**, **free.sulfur.dioxide**, **total.sulfur.dioxide** e **sulphates** têm cauda longa.

Esses fatores terão suas distribuições e correlações estudadas mais à frente.

### Variável dependente
A variável **quality** será utilizada como variável dependente.
O estudo será feito a partir de outras variáveis que serão analisadas com relação à **quality**.

```{r echo=FALSE, warning=FALSE, message=FALSE}
# Histograma com a distribuição dos vinhos em qualidades
ggplot(aes(x = quality), data = vinhos) +
    geom_histogram(binwidth = 1, color = 'black', fill = '#099DD9') +
    xlab('Qualidade dos vinhos tinto') +
    ylab('') +
    ggtitle('Qualidade')

summary(vinhos$quality)
```

### Criando uma classificação baseada na qualidade dos vinhos
Dado que a variável *quality* apresenta apenas números inteiros, ou seja, não teremos vinhos classificados com qualidade 6.8, por exemplo, serão criadas **categorias** de classificação de vinhos.

Os vinhos estão classificados em uma escala de 0 a 10, sendo 0 a pior classificação de qualidade e 10 a melhor.

No dataset estudado, a maioria dos vinhos estão classificados com  qualidade 5 e 6. A pior qualidade observada foi 3 e a melhor foi 8.

Desse modo, os vinhos serão *categorizados* em:

1. **ruim** -> vinhos com notas de 0 a 4
2. **bom** -> vinhos com notas de 5 a 7
3. **excelente** -> vinhos com notas de 8 a 10

```{r echo=FALSE, warning=FALSE, message=FALSE}
# Grupos de qualidade
category <- c(0, 5, 8, 10)

# Rótulos para os intervalos
group <- c('ruim', 'bom', 'excelente')

# Classificando os vinhos de acordo com os grupos criados
vinhos$category <- cut(vinhos$quality,
                       category,
                       include.lowest = TRUE,
                       right = FALSE,
                       labels = group)

# Distribuição dos vinhos nas categorias
grid.arrange(# Gráfico de barra com as 3 categorias
             ggplot(aes(x = category), data = vinhos) +
                 geom_bar(color = 'black', fill = '#099DD9') +
                 xlab('Categorias dos vinhos tinto') +
                 ylab('') +
                 ggtitle('Categorias'),
             
             # Gráfico de barra com as 3 categorias empilhados
             # com as qualidades
             ggplot(aes(x = category, fill = factor(vinhos$quality)),
                    data = vinhos) +
                 geom_bar(color = 'black') +
                 xlab('Categorias dos vinhos tinto') +
                 ylab('') +
                 scale_fill_discrete(name = 'qualidade',
                                     guide = guide_legend(reverse = TRUE)) +
                 ggtitle('Categorias e qualidade') +
                 theme(legend.position = 'bottom'),
             ncol = 1)

```

No gráfico **Categorias** temos a distribuição dos vinhos distribuídos nas categorias, **ruim**, **bom** e **excelente**.

No gráfico **Categorias e qualidade** temos a mesma representação do gráfico anterior, mas com a exibição também das quantidades que aparecem em cada uma das categorias.

### Variáveis independentes
A seguir, as variáveis independentes serão analisadas com relação à variável dependente **quality**.
O objetivo é observar a distribuição e, principalmente, a correlação que cada ume tem com a variável dependente **quality**.
Isso servirá como base para as análises, porque as maiores correlações indicam maiores influência no fator qualidade.
Os gráficos das variáveis independentes apresentados a seguir já consideram a transformação logarítmica, quando necessária, em cada caso.

#### Acidez Fixa - fixed.acidity
```{r echo=FALSE, warning=FALSE, message=FALSE}
# Plota um gráfico de histograma e um boxplot relacionados
# Parâmetros: 
# @param dataset Objeto com o dataset armazenado
# @param variable Variável do dataset para ser usada no gráfico
# @param bin tamanho a ser atribuído em binwidth
# @param x_title Nome do eixo
# @param plot_title Nome do gráfico
plot_histbox <- function(data_set, variable, bin, x_title, plot_title) {
    
    # Criando o histograma
    p1 <- ggplot(aes(x = variable), data = data_set) +
        geom_histogram(binwidth = bin, color = 'black', fill = '#099DD9') +
        labs(x = x_title, y = '', title = plot_title)
    
    # Criando o boxplot
    p2 <- ggplot(aes(x = 1, y = variable), data = data_set) +
        geom_boxplot(color = 'black') +
        geom_jitter(aes(x = 1, y = variable, color = 'blue'), alpha = 0.3) +
        labs(y = x_title, x = '') +
        theme(legend.position = 'none') +
        coord_flip()
    
    # Retornando os dois em grade
    grid.arrange(p1, p2, ncol = 1)
}

# Plota um gráfico de histograma e um boxplot relacionados
# com o eixo transformado para Log10().
# Parâmetros: 
# @param dataset Objeto com o dataset armazenado
# @param variable Variável do dataset para ser usada no gráfico
# @param bin tamanho a ser atribuído em binwidth
# @param x_title Nome do eixo
# @param plot_title Nome do gráfico
plot_histboxLog10 <- function(data_set, variable, x_title, 
                              plot_title, intervals) {
    
    # Criando o histograma
    p1 <- ggplot(aes(x = variable), data = data_set) +
        geom_histogram(color = 'black', fill = '#099DD9') +
        scale_x_log10(breaks = intervals) +
        labs(x = x_title, y = '', title = plot_title)
    
    # Criando o boxplot
    p2 <- ggplot(aes(x = 1, y = variable), data = data_set) +
        geom_boxplot(color = 'black') +
        geom_jitter(aes(x = 1, y = variable, color = 'blue'), alpha = 0.3) +
        scale_y_log10(breaks = intervals) +
        labs(y = x_title, x = '') +
        theme(legend.position = 'none') +
        coord_flip()
    
    # Retornando os dois em grade
    grid.arrange(p1, p2, ncol = 1)
}
# Histograma e boxplot para Acidez Fixa
# Transformado em Log10()
plot_histboxLog10(data_set = vinhos,
                  variable = vinhos$fixed.acidity,
                  x_title = 'Acidez Fixa (ácido tartárico - g / dm^3)',
                  plot_title = 'Distribuição da Acidez Fixa',
                  intervals = seq(0, 20, 2))

summary(vinhos$fixed.acidity)
paste('Correlação da Acidez Fixa com a Qualidade: ', 
      with(vinhos, cor(fixed.acidity, quality)))
```

A variável de **Acidez Fixa** tem distribuição próxima de log-normal.

Sua correlação com a variável dependente **Qualidade** é de 0,12 e é considerada baixa Portanto, **não será avaliada**.

---

#### Acidez Volátil - volatile.acidity
```{r echo=FALSE, warning=FALSE, message=FALSE}
# Histograma e boxplot para Acidez Volátil
plot_histbox(data_set = vinhos,
             variable = vinhos$volatile.acidity,
             bin = 0.05,
             x_title = 'Acidez Volátil (ácido acético - g / dm^3)',
             plot_title = 'Distribuição da Acidez Volátil')

summary(vinhos$volatile.acidity)
paste('Correlação da Acidez Volátil com a Qualidade: ', 
      with(vinhos, cor(volatile.acidity, quality)))
```

A variável de **Acidez Volátil** tem distribuição próxima de normal com alguns picos, mas não caracteriza bimodal.

Sua correlação com a variável dependente **Qualidade** é de -0,39 e é 
considerada moderada. Portanto, **será avaliada**.

---

#### Ácido Cítrico - citric.acid
```{r echo=FALSE, warning=FALSE, message=FALSE}

# Histograma e boxplot para Ácido Cítrico
plot_histbox(data_set = vinhos,
             variable = vinhos$citric.acid,
             bin = 0.05,
             x_title = 'Ácido Cítrico (g / dm^3)',
             plot_title = 'Distribuição da Ácido Cítrico')

summary(vinhos$citric.acid)
paste('Correlação de Ácido Cítrico com a Qualidade: ', 
      with(vinhos, cor(citric.acid, quality)))
```

A variável de **Ácido Cítrico** não tem distribuição normal.

Sua correlação com a variável dependente **Qualidade** é de 0,23 e é considerada
moderada. Portanto, **será avaliada**.

---

#### Açúcar Residual - residual.sugar
```{r echo=FALSE, warning=FALSE, message=FALSE}

# Histograma e boxplot para Açúcar Residual
plot_histboxLog10(data_set = vinhos,
             variable = vinhos$residual.sugar,
             x_title = 'Açúcar Residual (g / dm^3)',
             plot_title = 'Distribuição de Açúcar Residual',
             intervals = seq(0, 18, 2))

summary(vinhos$residual.sugar)
paste('Correlação de Açúcar Residual com a Qualidade: ',
      with(vinhos, cor(residual.sugar, quality)))
```

A variável de **Açúcar Residual** tem distribuição log-normal enviesada para a direita com *long tail* e muitas exceções.

Sua correlação com a variável dependente **Qualidade** é de 0,01 e é considerada
fraca. Portanto, **não será avaliada**.

---

#### Cloretos - chlorides
```{r echo=FALSE, warning=FALSE, message=FALSE}

# Histograma e boxplot para Cloretos
plot_histboxLog10(data_set = vinhos,
                  variable = vinhos$chlorides,
                  x_title = 'Cloretos (cloreto de sódio - g / dm^3)',
                  plot_title = 'Distribuição de Cloretos',
                  intervals = seq(0, 0.8, 0.2))

summary(vinhos$chlorides)
paste('Correlação de Cloretos com a Qualidade: ', 
      with(vinhos, cor(chlorides, quality)))
```

A variável de **Cloretos** tem distribuição log-normal enviesada para a direita com *long tail* e muitas exceções.

Sua correlação com a variável dependente **Qualidade** é de -0,13 e é 
considerada fraca. Portanto, **não será avaliada**.

---

#### Dióxido de Enxofre Livres - free.sulfur.dioxide
```{r echo=FALSE, warning=FALSE, message=FALSE}

# Histograma e boxplot para Dióxido de Enxofre Livres
plot_histbox(data_set = vinhos,
             variable = vinhos$free.sulfur.dioxide,
             bin = 1,
             x_title = 'Dióxido de Enxofre Livres (mg / dm^3)',
             plot_title = 'Distribuição de Dióxido de Enxofre Livres')


summary(vinhos$free.sulfur.dioxide)
paste('Correlação de Dióxido de Enxofre Livres com a Qualidade: ', 
      with(vinhos, cor(free.sulfur.dioxide, quality)))
```

A variável de **Dióxido de Enxofre Livres** tem distribuição normal enviesada para a direita, com alguns picos e com *long tail* e exceções.

Sua correlação com a variável dependente **Qualidade** é de -0,05 e é 
considerada fraca. Portanto, **não será avaliada**.

---

#### Dióxido de Enxofre Total - total.sulfur.dioxide
```{r echo=FALSE, warning=FALSE, message=FALSE}

# Histograma e boxplot para Dióxido de Enxofre Total
plot_histboxLog10(data_set = vinhos,
             variable = vinhos$total.sulfur.dioxide,
             x_title = 'Dióxido de Enxofre Total (mg / dm^3)',
             plot_title = 'Distribuição de Dióxido de Enxofre Total',
             intervals = seq(0, 300, 50))

summary(vinhos$total.sulfur.dioxide)
paste('Correlação de Dióxido de Enxofre Total com a Qualidade: ', 
      with(vinhos, cor(total.sulfur.dioxide, quality)))
```

A variável de **Dióxido de Enxofre Total** tem distribuição próxima de log-normal com poucas exceções.

Sua correlação com a variável dependente **Qualidade** é de -0,18 e é 
considerada fraca. Portanto, **não será avaliada**.


---

#### Densidade - density
```{r echo=FALSE, warning=FALSE, message=FALSE}

# Histograma e boxplot para Densidade
plot_histbox(data_set = vinhos,
             variable = vinhos$density,
             bin = 0.0005,
             x_title = 'Densidade (g / cm^3)',
             plot_title = 'Distribuição de Densidade')

summary(vinhos$density)
paste('Correlação de Densidade com a Qualidade: ', 
      with(vinhos, cor(density, quality)))
```

A variável de **Densidade** tem distribuição normal. Apresenta exceções nas duas extremidades de amostras.

Sua correlação com a variável dependente **Qualidade** é de -0,17 e é 
considerada fraca. Portanto, **não será avaliada**.


---

#### Potencial Hidrogeniônico - pH
```{r echo=FALSE, warning=FALSE, message=FALSE}

# Histograma e boxplot para pH
plot_histbox(data_set = vinhos,
             variable = vinhos$pH,
             bin = 0.04,
             x_title = '',
             plot_title = 'Distribuição de pH')

summary(vinhos$pH)
paste('Correlação de pH com a Qualidade: ', with(vinhos, cor(pH, quality)))
```

A variável de **Potencial Hidrogeniônico** tem distribuição normal.

Sua correlação com a variável dependente **Qualidade** é de -0,06 e é 
considerada desprezível. Portanto, **não será avaliada**.

---

#### Sulfatos - sulphates
```{r echo=FALSE, warning=FALSE, message=FALSE}

# Histograma e boxplot para Sulfatos
plot_histboxLog10(data_set = vinhos,
             variable = vinhos$sulphates,
             x_title = 'Sulfatos (sulfato de potássio - g / dm^3)',
             plot_title = 'Distribuição de Sulfatos',
             intervals = seq(0, 2, 0.5))

summary(vinhos$sulphates)
paste('Correlação de Sulfatos com a Qualidade: ', 
      with(vinhos, cor(sulphates, quality)))
```

A variável de **Sulfatos** tem distribuição log-normal com *long tail* e muitas exceções.

Sua correlação com a variável dependente **Qualidade** é de 0.25 e é 
considerada moderada. Portanto, **será avaliada**.

---

#### Álcool - alcohol
```{r echo=FALSE, warning=FALSE, message=FALSE}

# Histograma e boxplot para Álcool
plot_histboxLog10(data_set = vinhos,
             variable = vinhos$alcohol,
             x_title = 'Álcool (% por volume)',
             plot_title = 'Distribuição de Álcool',
             intervals = seq(8, 16, 2))

summary(vinhos$alcohol)
paste('Correlação de Álcool com a Qualidade: ', 
      with(vinhos, cor(alcohol, quality)))
```

A variável de **Álcool** tem distribuição próxima de log-normal enviesada para a direita com poucas exceções.

Sua correlação com a variável dependente **Qualidade** é de 0.48 e é 
considerada moderada. Portanto, **será avaliada**.

# Análise Univariada

### Qual é a estrutura do conjunto de dados?
```{r echo=FALSE, warning=FALSE, message=FALSE}
str(vinhos)
```
Adicional ao que é exibido na função str(), de acordo com o arquivo 
*wineQualytiInfo.txt* obtido do repositório da Udacity no endereço 
https://s3.amazonaws.com/udacity-hosted-downloads/ud651/wineQualityInfo.txt, 
o conjunto de dados tem a seguinte estrutura de variáveis:

**Input variables (based on physicochemical tests):**

1. **fixed acidity** (tartaric acid - g / dm^3)
2. **volatile acidity** (acetic acid - g / dm^3)
3. **citric acid** (g / dm^3)
4. **residual sugar** (g / dm^3)
5. **chlorides** (sodium chloride - g / dm^3
6. **free sulfur dioxide** (mg / dm^3)
7. **total sulfur dioxide** (mg / dm^3)
8. **density** (g / cm^3)
9. **pH**
10. **sulphates** (potassium sulphate - g / dm3)
11. **alcohol** (% by volume)
   
**Output variable (based on sensory data): **

12. **quality** (score between 0 and 10)

### Quais são os principais atributos de interesse deste conjunto de dados?

**QUALITY** é o atributo principal, pois ele define a qualidade do vinho 
baseado nos outros fatores.

```{r echo=FALSE, warning=FALSE, message=FALSE}
summary(vinhos$quality)
```

### Quais outros atributos você acha que podem lhe auxiliar na investigação destes atributos de interesse?

#### Correlação das variáveis independentes da variável dependente **quality**
 variável             | correlação |
----------------------|------------|
fixed.acidity         |        0.12|
volatile.acidity      |       -0.39|
citric.acid           |        0.23|
residual.sugar        |        0.01|
chlorides             |       -0.13|
free.sulfur.dioxide   |       -0.05|
total.sulfulr.dioxide |       -0.19|
density               |       -0.17|
pH                    |       -0.06|
sulphates             |        0.25|
alcohol               |        0.48|
  
De acordo com a tabela acima, não temos nenhuma variável com uma correlação forte.

Com base nos valores de correlação obtidos, os atributos que podem auxiliar a investigação são:

1. **ALCOHOL**
2. **VOLATILE.ACIDITY**
3. **SULPHATES**
4. **CITRIC.ACID**


### Você criou novas variáveis a partir dos atributos existentes no conjunto de dados?
Foi criada a variável **category**, conforme descrito acima para classificar 
os vinhos em ruins, bons e excelentes.

### Dos atributos investigados, distribuições incomuns foram encontradas? Você aplicou operações nos dados para limpá-los, ajustá-los ou mudar a forma dos dados? Se sim, por quê?
Foram encontradas as seguintes variáveis com distribuição normal (ou bem próximas):

* volatile.acidity
* free.sulfur.dioxide
* density
* pH
* quality

As variáveis a seguir têm distribuição log-normal (ou bem próximas)

* fixed.acidity
* total.sulfur.dioxide
* residual.sugar
* chlorides
* sulphates
* alcohol

A variáveis a seguir têm distribuição não normal

* citric.acid


Não houve necessidade de ajustes ou formatação dos dados, por serem
todos numéricos.

# Seção de Gráficos Bivariados
### Análise das quatro variáveis com maior correlação com a variável **quality**.
O diagrama a seguir mostra a influência que cada uma das variáveis selecionadas exerce na qualidade dos vinhos e são agrupadas nas notas que cada vinho recebeu e também são destacadas nas categorias excelente, bom e ruim.
```{r echo=FALSE, Bivariate_Plots}
# Plota um gráfico boxplot
# Parâmetros: 
# @param dataset Objeto com o dataset armazenado
# @param variable Variável do dataset para ser usada no gráfico
# @param y_title Nome do eixo
# @param plot_title Nome do gráfico
plot_boxplot <- function(data_set, variable, y_title, plot_title) {
    
    # Criando o boxplot
    ggplot(aes(x = factor(quality, ordered = T), y = variable,
               fill = category), data = data_set) +
    geom_boxplot() +
    ggtitle(plot_title) +
    xlab('qualidade') +
    ylab(y_title) +
    guides(fill = guide_legend(reverse = TRUE)) +
        scale_fill_discrete(name = 'categoria')
}

# Matriz de gráficos boxplot com os fatores relacionados com a qualidade
grid.arrange(# Álcool
             plot_boxplot(data_set = vinhos,
                          variable = vinhos$alcohol,
                          y_title = '% por volume',
                          plot_title = 'Álcool'),
             
             # Acidez volátil
             plot_boxplot(data_set= vinhos,
                          variable = vinhos$volatile.acidity,
                          y_title = 'ácido acético - g / dm^3',
                          plot_title = 'Acidez Volátil'),
             
             # Sulfato
             plot_boxplot(data_set= vinhos,
                          variable = vinhos$sulphates,
                          y_title = 'sulfato de potássio - g / dm^3',
                          plot_title = 'Sulfatos'),
             
             # Ácido cítrico
             plot_boxplot(data_set= vinhos,
                          variable = vinhos$citric.acid,
                          y_title = 'ácido cítrico (g / dm^3)',
                          plot_title = 'Ácido Cítrico'),
             ncol = 2)
```

---

#### Influência dos componentes na qualidade dos vinhos

#### **Álcool** - melhores qualidades de vinhos observadas quando o teor alcoólico é mais alto, acima de 10% do volume.

Entretanto, há uma inversão com vinhos categorizados como bons, porém com qualidade 5. Vinhos com qualidade inferior (3 e 4) possuem teores alcoólicos acima.

---

#### **Acidez Volátil** - a quantidade apresentada desse componente é inversamente proporcional à qualidade. Vinhos com presença de ácido acético abaixo de 0.6 g/dm^3 são de melhor qualidade.

---

#### **Sulfatos** - índices maiores de presença de sulfato de potássio melhoram a qualidade do vinho. Valores acima de 0.6 g/dm^3 já estão presentes nas categorias dos vinhos bons.

---

#### **Ácido Cítrico** - semelhante ao sulfato de potássio, maiores índices dessa substância são encontradas em vinhos bons, em geral, valores acima de 0.25 g/dm^3.

---

#### Analisando outras correlações com os itens tidos como *não de interesse*

Analisando os fatores que foram descartados da primeira análise podemos identificar se existe entre eles alguma correlação forte.
O diagrama a seguir mostra todas essas correlações.

#### **Matriz de correlação**
```{r echo=FALSE, warning=FALSE, message=FALSE}
# Novo dataset apenas com as variáveis não analisadas
vinhos_subset = subset(vinhos, select = c(fixed.acidity, 
                                          residual.sugar, 
                                          chlorides, 
                                          free.sulfur.dioxide, 
                                          total.sulfur.dioxide, 
                                          density, 
                                          pH))
M <- cor(vinhos_subset)

# Plotando a matriz de correlação
corrplot(M, type = 'upper', method = 'color', 
         addCoef.col = 'black', tl.srt = 45)
```




# Análise Bivariada

### Discuta sobre alguns dos relacionamentos observados nesta parte da investigação. Como os atributos de interesse variaram no conjunto de dados?
Conforme observado na seção **Influência dos componentes na qualidade** 
**dos vinhos**, melhores vinhos têm:

* Mais altos teores alcoólicos
* Menores índices de acidez volátil
* Maiores índices de sulfatos
* Maiores índices de ácido cítrico

### Você observou algum relacionamento interessante entre os outros atributos (os que não são de interesse)?

Dos atributos que não foram selecionados para a análise, foram encontradas 
duas correlações fortes:

* pH vs fixed.acidity --> correlação = -0.683
* density vs pH --> correlação = 0.668

Os atributos pH e fixed.acidity não parecem muito relevantes, porque os dois se relacionam com alcalinidade dos vinhos. Não há vinho tendendo a ser ácido. 

Todos são alcoólicos. O próprio fator pH tem correlação muito fraca com a  qualidade, da ordem de -0.06.

### Qual foi o relacionamento mais forte encontrado?
O maior correlacionamento encontrado entre os itens de interesse foi:

* alcohol vs quality = 0.48

O maior correlacionamento encontrado entre os itens de não interesse foi:

* pH vs fixed.acidity = 0.68


# Seção de Gráficos Multivariados

A análise bivariada dos fatores "de não interesse" não trouxe nenhuma tendência significativa e, portanto, esses fatores foram descartados.

A partir dessa observação, o estudo segue analisando os 4 primeiros fatores que já tinham sido escolhidos como "de interesse".

Estudamos, a seguir, a correlação entre esses fatores. Para isso serão utilizados gráficos de disperção com a apresentação da linha de tendência. Dessa forma é possível uma interpretação visual dos resultados.

A inclinação da linha de tendência indica a correlação. Quanto mais inclinada, maior é a correlação entre os fatores analisados.
```{r echo=FALSE, warning=FALSE, message=FALSE, Multivariate_Plots}

# Plota um gráfico de dispersão com linha de tendência
# Parâmetros: 
# @param dataset Objeto com o dataset armazenado
# @param x_variable Variável do dataset para eixo X
# @param y_variable Variável do dataset para eixo Y
# @param x_title Nome do eixo x
# @param y_tilte Nome do eixo y
# @param plot_title Nome do gráfico
plot_scatter <- function(data_set, x_variable, y_variable, 
                         x_title, y_title, plot_title) {
    
    # Correlação entre os dois fatores
    v_corr = round(cor(x_variable, y_variable), digits = 3)
    
    # Gráfico de dispersão com linha de tendência
    ggplot(aes(x = x_variable, y = y_variable), data = data_set) +
        geom_point(aes(color = category)) +
        #scale_fill_brewer(palette="Set1") +
        scale_color_manual(values=c("yellow", "#E15759", "blue"),
                           guide = guide_legend(reverse = TRUE),
                           name = 'categoria') +
        ggtitle(plot_title) +
        labs(x = paste(c(x_title, v_corr), collapse = " "),
             y = y_title) +
        # linha de tendência
        geom_smooth(method = 'lm', color = 'black') +
        theme_gray()
    
}
```
```{r echo=FALSE, warning=FALSE, message=FALSE}
# Correlação Álcool vs. Acidez Volátil nas categorias
plot_scatter(data_set = vinhos,
             x_variable = vinhos$alcohol,
             y_variable = vinhos$volatile.acidity,
             x_title = '(Álcool) correlação = ',
             y_title = 'Acidez Volátil',
             plot_title = 'Álcool vs. Acidez Volátil')
```

Correlação **Álcool vs. Acidez Volátil** é fraca (-0.202). Não será considerada na análise.

---

```{r echo=FALSE, warning=FALSE, message=FALSE}
# Correlação Álcool vs. Sulfatos nas categorias
plot_scatter(data_set = vinhos,
             x_variable = vinhos$alcohol,
             y_variable = vinhos$sulphates,
             x_title = '(Álcool) correlação = ',
             y_title = 'Sulfatos',
             plot_title = 'Álcool vs. Sulfato')
```

Correlação **Álcool vs. Sulfatos** é muito fraca (0.094). Não será considerada na análise.

---

```{r echo=FALSE, warning=FALSE, message=FALSE}
# Correlação Álcool vs. Ácidos Cítricos nas categorias
plot_scatter(data_set = vinhos,
             x_variable = vinhos$alcohol,
             y_variable = vinhos$citric.acid,
             x_title = '(Álcool) correlação = ',
             y_title = 'Ácidos Cítricos',
             plot_title = 'Álcool vs. Ácidos Cítricos')
```

Correlação **Álcool vs. Ácidos Cítricos** é muito fraca (0.110). Não será considerada na análise.

---

```{r echo=FALSE, warning=FALSE, message=FALSE}
# Correlação Acidez Volátil vs. Sulfatos nas categorias
plot_scatter(data_set = vinhos,
             x_variable = vinhos$volatile.acidity,
             y_variable = vinhos$sulphates,
             x_title = '(Acidez Volátil) correlação = ',
             y_title = 'Sulfatos',
             plot_title = 'Acidez Volátil vs. Sulfatos')
```

Correlação **Acidez Volátil vs. Sulfatos** é mediana (-0.261). Será discutida na seção seguinte.

---

```{r echo=FALSE, warning=FALSE, message=FALSE}
# Correlação Acidez Volátil vs. Ácidos Cítricos nas categorias
plot_scatter(data_set = vinhos,
             x_variable = vinhos$volatile.acidity,
             y_variable = vinhos$citric.acid,
             x_title = '(Acidez Volátil) correlação = ',
             y_title = 'Ácidos Cítricos',
             plot_title = 'Acidez Volátil vs. Ácidos Cítricos')
```

Correlação **Acidez Volátil vs. Ácidos Cítricos** é forte (-0.552). Será discutida na seção seguinte.

---

```{r echo=FALSE, warning=FALSE, message=FALSE}
# Correlação Sulfatos vs. Ácidos Cítricos nas categorias
plot_scatter(data_set = vinhos,
             x_variable = vinhos$sulphates,
             y_variable = vinhos$citric.acid,
             x_title = '(Sulfatos) correlação = ',
             y_title = 'Ácidos Cítricos',
             plot_title = 'Sulfatos vs. Ácidos Cítricos')

```

Correlação **Sulfatos vs. Ácidos Cítricos** é mediana (0.313). Será discutida na seção seguinte.

---

# Análise Multivariada

### Discuta sobre os relacionamentos observados nesta parte da investigação. Quais atributos que fortaleceram os demais na observação das variáveis de interesse?

* O percentual alcoólico é o índice que mais contribui com a qualidade de um vinho. Em geral, bons vinhos tem um teor alcoólico entre 9.5 e 14.
* Sulfatos e ácidos cítricos também contribuem com a qualidade do vinho quando seus valores são mais altos.
* A acidez volátil é prejudicial à qualidade do vinho, pois quanto menores os índices encontrados desse elemento, maior a qualidade do vinho.

### Interações surpreendentes e/ou interessantes foram encontradas entre os atributos?

Calculando-se a correlação entre os fatores de interesse e analisando os gráficos anteriores observa-se que, associado ao percentual alcoólico, também temos que bons vinhos apresentam os seguintes índices:

* Acidez Volátil entre 0.3 e 0.8 g/dm^3 (melhor nos menores índices)
* Sulfatos entre 0.5 e 0.75 g/dm^3 (melhor nos maiores índices)
* Ácidos Cítricos entre 0.0 e 0.5 g/dm^3 (melhor nos maiores índices)

Os gráficos de disperção com a linha de tendência confirmam o que foi apresentado na seção de **Gráficos Bivariados** no diagrama com os gráficos de BoxPlot.

### OPCIONAL: Modelos foram criados usando este conjunto de dados? Discuta sobre os pontos fortes e as limitações do seu modelo.

------

# Gráficos Finais e Sumário

### Primeiro Gráfico
```{r echo=FALSE, Plot_One}
# Gráfico de barra com as 3 categorias empilhados
# com as qualidades
ggplot(aes(x = category, fill = factor(vinhos$quality)), data = vinhos) +
    geom_bar(color = 'black') +
    xlab('Categorias dos vinhos tinto') +
    ylab('quantidade') +
    scale_fill_discrete(name = 'qualidade',
                        guide = guide_legend(reverse = TRUE)) +
    ggtitle('Categorias e qualidade')
```

### Descrição do Primeiro Gráfico

Esse primeiro gráfico é o elemento que guia todo o estudo do dataset porque nele encontramos distribuídos os vinhos em uma escala de qualidade e agrupados por categorias.

Os vinhos são classificados em notas de 0 a 10 e agrupados em 3 categorias, excelente, bom e ruim.

Mostrando a variação do fator mais importante, o teor alcoólico é o elemento que mais contribui na qualidade do vinho.

---

### Segundo Gráfico
```{r echo=FALSE, Plot_Two}
# Gráfico Boxplot representando a variação do álcool com relação
# à qualidade, distribuídos em qualidades e categorias
plot_boxplot(data_set = vinhos,
             variable = vinhos$alcohol,
             y_title = 'Álcool (% por volume)',
             plot_title = 'Percentual de Álcool')
```

### Descrição do Segundo Gráfico

Mostrando a variação do fator mais importante, o teor alcoólico é o elemento que mais contribui na qualidade do vinho.

Vinhos de melhor qualidade apresentam teores alcoólicos maiores.

Apesar de vinhos de qualidade inferior terem a mediana do teor alcoólico levemente superior aos vinhos da primeira categoria de bons (com notas = 5), outros fatores associados influenciam nesse resultado. Portanto, a tendência de maiores índices de álcool iniciando em vinhos com nota 5 indica que são diretamente proporcionais.

---

### Terceiro Gráfico
```{r echo=FALSE, Plot_Three}
# Matriz de gráficos boxplot com os fatores relacionados com a qualidade
grid.arrange(# Álcool
             plot_boxplot(data_set = vinhos,
                          variable = vinhos$alcohol,
                          y_title = '% por volume',
                          plot_title = 'Álcool'),
             
             # Acidez volátil
             plot_boxplot(data_set= vinhos,
                          variable = vinhos$volatile.acidity,
                          y_title = 'ácido acético - g / dm^3',
                          plot_title = 'Acidez Volátil'),
             
             # Sulfato
             plot_boxplot(data_set= vinhos,
                          variable = vinhos$sulphates,
                          y_title = 'sulfato de potássio - g / dm^3',
                          plot_title = 'Sulfatos'),
             
             # Ácido cítrico
             plot_boxplot(data_set= vinhos,
                          variable = vinhos$citric.acid,
                          y_title = 'ácido cítrico (g / dm^3)',
                          plot_title = 'Ácido Cítrico'),
             ncol = 2)
```

### Descrição do Terceiro Gráfico

Por fim, a apresentação dos 4 fatores fortes, também classificados pelas notas e agrupados pelas categorias.

Nesse diagrama temos a representação gráfica da conclusão apresentada na seção de **Análise Multivariada**, onde foram discutidas as correlações entre esses fatores e como eles influenciam na qualidade do vinho.

------

# Reflexão
### Resumo dos pontos encontrados na análise

Analisando o dataset de **Qualidade de Vinhos Tintos**, logo no primeiro contato foi possível identificar que o fator denominado *quality* (qualidade) seria o fator que guiaria todas as outras análises.
Estudando a variável **quality** com um pouco mais de profundidade, observa-se que a nota dos vinhos está distribuída em uma escala de 0 a 10 e para o conjunto de dados estudado temos amostras com notas variando de 3 a 8.
Assim, para não ter apenas a nota como referência, os vinhos foram categorizados de acordo com suas notas em:

#### Categorias dos vinhos
nota      | categoria
----------|----------
de 0 a 4  | ruim
de 5 a 7  | bom
de 8 a 10 | excelente

Seguindo esse raciocínio, o próximo passo foi entender como os outros fatores influenciam na qualidade do vinho.
Para fazer isso foram calculadas as correlações de todos os outros fatores com relação ao fator de qualidade.
O que se descobriu nesse ponto é que 4 fatores têm maior influência na qualidade dos vinhos do que o restante.

#### Fatores relevantes para definir a qualidade do vinho
A análise mostrou que os seguintes fatores e suas respectivas correlações com a variável **quality** influenciam significativamente na qualidade dos vinhos:

 fator           | correlação 
-----------------|-----------
alcohol          |   0.48
volatile.acidity |  -0.39
sulphates        |   0.25
citric.acid      |   0.23

---

Uma vez encontrados os fatores mais fortes que determinam a qualidade dos vinhos, foi realizado um outro estudo, agora com os fatores inicialmente descartados, por terem menores correlações com a variável **quality**.

#### Correlações secundárias encontradas

Dos fatores inicialmente descartados, duas correlações chamaram a atenção;

fator 1 | fator 2       | correlação
--------|---------------|-----------
pH      | fixed.acidity | -0.683
density | pH            |  0.668

Apesar de terem correlação forte, esses fatores não foram estudados por estarem intimamente ligados à alcalinidade do vinho.
Essa conclusão baseou-se por se tratar de um elemento substancialmente de pH alcoólico e também por motivo de o pH ter correlação baixíssimo com o fator **quality**.

#### Conclusão

Segundo o estudo do dataset pode-se concluir que um vinho de boa qualidade apresenta os seguintes fatores e valores:

fator           | faixa de qualidade      | observação
----------------|-------------------------|---------------------------
Álcool          | entre 9.8 e 12.2 %      | melhor nos maiores índices
Acidez Volátil  | entre 0.3 e 0.8 g/dm^3  | melhor nos menores índices
Sulfatos        | entre 0.5 e 0.75 g/dm^3 | melhor nos maiores índices
Ácidos Cítricos | entre 0.0 e 0.5 g/dm^3  | melhor nos maiores índices

As afirmações acima podem ser comprovadas nos gráficos apresentados na seção do **Segundo Gráfico** acima.

---

### Algumas limitações observadas
#### Alta concentração de vinhos na categoria **bom**
O dataset é pobre em amostragens de vinhos com notas mais baixas (0 a 4) e nas mais altas (8 a 10).
Para uma melhor confiabilidade do estudo seria mais interessante que o dataset trouxesse uma distribuição de notas com uma representatividade maior dos vinhos ruins e dos excelentes.

#### Ausência de correlação forte
Dos 4 fatores mais fortes estudados, nenhum deles tem realmente uma grande correlação com a qualidade. Todos estão abaixo de 0.5.
Todo o estudo seguiu baseado em correlações de moderadas a baixas.

---

### Ações para melhoria desse estudo
Uma melhoria desse dataset pode trazer resultados mais relevantes se fossem incluídas algumas outras variáveis.
#### Ausência de algumas variáveis

* Temperatura
Estudiosos e apreciadores de vinho costumam recomendar um range de temperaturas que consideram ideias para apreciar quada tipo de vinho.

* Qualidade da uva
Com as variedades de uvas já estabelecidas com os produtores, esse fator deveria estar presente no dataset.

* País de origem
Os mesmos tipos de vinhos, com as mesmas características e usando as mesmas uvas podem trazer resultados diferentes se forem produzidos em outros países, porque sofrem influência de clima, solo, pressão atmosférica e até fatores culturais nos processos de fabricação.

# Fontes

* Dataset de vinhos - https://s3.amazonaws.com/udacity-hosted-downloads/ud651/wineQualityInfo.txt
* Ajustes de legendas de gráficos - http://www.cookbook-r.com/Graphs/Legends_(ggplot2)/#reversing-the-order-of-items-in-the-legend
* Dicas de markdown - https://www.rstudio.com/wp-content/uploads/2015/02/rmarkdown-cheatsheet.pdf
